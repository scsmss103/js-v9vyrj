<!DOCTYPE html>
<html>

<head>
	<base target="_top">
	<title style="position:fixed;">Sam's overview page</title>
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<script src="./index.js"></script>
	<script src="https://www.gstatic.com/charts/loader.js"></script>


</head>

<body>

	<div class='img_head'>
	</div>

	<button onclick="buttons('div_ivr'), load_ivr()" class="w3-button w3-block w3-left-align w3-jumbo w3-indigo w3-margin-bottom" style='font-weight: bold'>
      IVR
    </button>


	<div id='div_ivr' class='w3-hide'>

		<div class='w3-row'>
			<input type='text' id="myFilter" style='margin-left:10px; font-size:3vh; max-width:50%;'   placeholder="Search for Ticker.."  >

			<button class='w3-button w3-light-grey ' onclick="sort_table()" style="width: 30%; font-size:2vh; margin-left:50px;"> sort table desc
	</button>

		</div>
		<br>
		<br>

		<table id='myTable' class='w3-table w3-striped w3-hoverable w3-xxxlarge'>
			<thead>
				<th>Ticker</th>
				<th>IV 30</th>
				<th>IV Min</th>
				<th>IV Max</th>
				<th>IVR</th>
        <th>Earnings</th>
			</thead>
			<tbody id="ivr_table">

			</tbody>
		</table>

		<div class="pagination">
			<p id="page1" class="active" onclick="change_page('page1')">1</p>
			<p id="page2" onclick="change_page('page2')">2</p>
			<p id="page3" onclick="change_page('page3')">3</p>
			<p id="page4" onclick="change_page('page4')">4</p>
			<p id="page5" onclick="change_page('page5')">5</p>
			<p id="page6" onclick="change_page('page6')">6</p>
			<p id="page7" onclick="change_page('page7')">7</p>
			<p id="page8" onclick="change_page('page8')">8</p>
			<p id="page9" onclick="change_page('page9')">9</p>
			<p id="page10" onclick="change_page('page10')">10</p>
		</div>
		<br>
		<br>
</div>

		<button onclick="buttons('div_runs'), load_runs(), load_data_val()" class="w3-button w3-block w3-left-align w3-jumbo w3-indigo w3-margin-bottom" style='font-weight: bold'>
      Runs
    </button>


		<div id='div_runs' class=' w3-hide'>
			<table class="w3-table w3-striped w3-hoverable w3-responsive w3-mobile w3-xxlarge " style='font-size:2vh;'>
				<thead>
					<th> Date</th>
					<th> Start Time</th>
					<th> End Time</th>
					<th> Errors</th>
					<th> Script Name</th>
					<th> Run Time</th>

				</thead>
				<tbody id="run_table">

				</tbody>
			</table>
			<br>
			<br>
			<table class="w3-table w3-striped w3-hoverable w3-responsive w3-mobile w3-xxlarge " style='font-size:2vh;'>
				<thead>
					<th>Table</th>
					<th>Date</th>
					<th>No. of rows</th>
					<th>No. of tickers</th>
				</thead>
				<tbody id="data_val_table">
				</tbody>
			</table>
		</div>

		<button onclick="buttons('div_calculator')" class="w3-button w3-block w3-left-align w3-jumbo w3-indigo w3-margin-bottom" style='font-weight: bold'>
      Fx Calculator
    </button>

		<div id='div_calculator' class='w3-hide' style='width:100%; font-size:3vh;'>


			<label>Profit target: </label><input type='text' id='tgt' style='float:right;width:40%; margin-right:20px; ' value= 52>
			<br><br>
			<label>Currency: </label><input type='text' id='ccy' style='float:right; width:40%;margin-right:20px;'>
			<br><br>
			<label style='text-align:center'>ATR: </label><input type='text' id='atr' style='float:right;width:40%;margin-right:20px;'>
			<br><br>
			<label  style='text-align:center'>FX rate: </label>
			<div id=fx_rate style='float:right;width:40%;margin-right:20px;'></div>
			<br><br>
			<label  style='text-align:center'>Position size: </label>
			<div id="pos_size" style='float:right;width:40%;margin-right:20px;'></div>
			<br><br>
			<input type='button' onclick="calc_pos_size()"  value='calculate' style='float:right; width:40%; margin-right:20px;'>
			<br><br>

    </div>


			<button onclick="buttons('div_charts'),loadChart()" class="w3-button w3-block w3-left-align w3-jumbo w3-indigo w3-margin-bottom" style='font-weight: bold'>
      Show charts
    </button>

			<div id='div_charts' class='w3-hide' style='width:100%; height:100%;  font-size: 3vh;'>
			</div>


			<<!-- The core Firebase JS SDK is always required and must be listed first -->
				<script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-app.js"></script>

				<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
				<script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-analytics.js"></script>
				<script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-firestore.js"></script>

				<script src="https://www.gstatic.com/firebasejs/7.2.2/firebase-storage.js"></script>

				<script>
					// Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyBvXl4M6mjgaK_xyzfNG2Qmp0gcxiktu-0",
    authDomain: "stock-price-b675c.firebaseapp.com",
    databaseURL: "https://stock-price-b675c.firebaseio.com",
    projectId: "stock-price-b675c",
    storageBucket: "stock-price-b675c.appspot.com",
    messagingSenderId: "434049662522",
    appId: "1:434049662522:web:5e73672d17d9d69f39bf03",
    measurementId: "G-V5GQX48SD7"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();


var db = firebase.firestore();

function load_runs(){
var ref_html = db.doc('date/htmls');
ref_html.get().then(function(doc){
  var data1 = doc.data();
  //console.log(data1);
  var html = '';

  for (i in data1){
    //console.log(i)   
    html += data1[String(i)]; 
   };
  document.getElementById("run_table").innerHTML = html;
  });
};


function load_data_val(){

var ref_data_val = db.collection('date/data_val/uploads');
var html_data_val='';
ref_data_val.get().then(function(tbl){

tbl.forEach(function(doc_data_val){
var new_ref = ref_data_val.doc(doc_data_val.id);


new_ref.get().then(function(field){
data_val_data = field.data();

html_data_val+='<tr><td>'+doc_data_val.id+'</td>';
html_data_val+='<td>'+data_val_data['date']+'</td>';
html_data_val+='<td>'+data_val_data['no_rows']+'</td>';
html_data_val+='<td>'+data_val_data['no_ticker']+'</td></tr>';

document.getElementById('data_val_table').innerHTML = html_data_val;
});
});
});
};


function load_ivr(){

var ref_ivr = db.collection('date/ivr/ticker');
var html_ivr ='';
ref_ivr.get().then(function(col){


col.forEach(function(doc_ivr){
var data_ivr1 = doc_ivr;



var new_ref = ref_ivr.doc(doc_ivr.id);
new_ref.get().then(function(new_doc){
var ivr_data = new_doc.data()

html_ivr += '<tr><td>'+doc_ivr.id+'</td>';
html_ivr += '<td>'+ivr_data['iv_30']+'</td>';
html_ivr += '<td>'+ivr_data['min_iv']+'</td>';
html_ivr += '<td>'+ivr_data['max_iv']+'</td>';
html_ivr += '<td>'+ivr_data['ivr']+'</td>';
html_ivr += '<td class="w3-xxlarge">'+ivr_data['earnings']+'</td></tr>';

document.getElementById('ivr_table').innerHTML = html_ivr;
});

})

});
setTimeout(function(){
var table = document.getElementById('ivr_table');
var tr = table.getElementsByTagName('tr');

for(i=0;i<tr.length;i++){
tr[i].classList.add(i);

};
change_page("page1");
}, 3000
);
};


function buttons(id){

var x = document.getElementById(id);
if(x.className.indexOf('w3-show')==-1){
  x.className += 'w3-show';
}
else{
  x.className = x.className.replace("w3-show",'')
};
};      
      
      
function calc_pos_size(){

tgt = document.getElementById('tgt').value;
ccy = document.getElementById('ccy').value.toUpperCase();
atr = document.getElementById('atr').value;
var ref_fx = db.doc('date/fx_rates/ccy/'+ccy);

ref_fx.get().then(function(fx_data){
fx_dat = fx_data.data();
fx = fx_dat['rate'];
fx_date = fx_dat['date'];
pos = (tgt/fx)/(atr*0.25);

pos = Math.round(pos*100)/100;
console.log(pos);

document.getElementById('pos_size').innerHTML = pos;
document.getElementById('fx_rate').innerHTML = String(fx)+' <span style="font-size:0.5em">('+fx_date+')</span>';

});
}  

 

      
				</script>

</body>

</html>